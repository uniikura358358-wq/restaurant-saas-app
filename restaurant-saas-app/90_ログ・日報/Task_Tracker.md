# Firebase Unification Tasks (Final Plan)

- [x] å‹•ä½œç¢ºèªãƒ»æ¤œè¨¼
  - [x] èªè¨¼ã‚¨ãƒ©ãƒ¼ã®æœ‰ç„¡ç¢ºèª (ãƒ“ãƒ«ãƒ‰é€šéãƒ»é™çš„è§£æ)
  - [x] å¿œç­”ç”Ÿæˆã®ç¢ºèª (ã‚³ãƒ¼ãƒ‰æ•´åˆæ€§ç¢ºèª)
  - [x] UIé€£æºæ™‚ã®èªè¨¼ã‚¨ãƒ©ãƒ¼ä¿®æ­£
  - [x] é‡è¤‡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (PascalCaseãƒ•ã‚¡ã‚¤ãƒ«) ã®å‰Šé™¤
- [x] **Phase 14: Customer Support Chat Globalization & Emoji Refinement** `[x]`
  - [x] **RootLayout Integration**: Move `CustomerSupportChat` to `RootLayout` for sitewide availability.
  - [x] **Clean Up**: Removed redundant instances of `CustomerSupportChat` from individual pages.
  - [x] **Emoji Logic Update**: Fixed `EMOJI_REGEX` to handle ZWJ sequences (e.g., ğŸ™‡â€â™‚ï¸) as one character.
  - [x] **Prompt Optimization**: Enhanced Star 1/2 instructions to ensure 2 emojis max and prioritize apology signs.
  - [x] **Scenario Branching**: Implemented `SCENARIO_SALES` and `SCENARIO_MEMBER` with path-based switching (`usePathname`).
  - [x] **Member Q&A**: Added guide content for Google AI, Instagram integration, Settings, and Billing.
  - [x] **Revenue Boost Guide**: Integrated "å£²ä¸ŠãŒä¸ŠãŒã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯é›†" (Phase 15) with specific tips for SEO and branding.
  - [x] **HP Usage Guide**: Implemented step-by-step lecture for Image Upload, Menu Update, and Daily Menu (Phase 16).
- [x] æ—¥å ±ãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
  - [x] `Dashboard.md` ã®æ›´æ–°
  - [x] æ—¥å ±ã®ä½œæˆ
- [x] ä¾å­˜é–¢ä¿‚ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  - [x] `@google-cloud/vertexai` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼æŠ‘åˆ¶
  - [x] ç®¡ç†è€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®æ“ä½œæ€§æ”¹å–„ (ãƒ‰ãƒ©ãƒƒã‚°ã€Premiumå¯¾å¿œã€ã‚¿ã‚¤ãƒä¿®æ­£)
- [x] Instagramé€£æºã®ãƒ©ãƒ™ãƒªãƒ³ã‚°ãƒ»é…ç½®ä¿®æ­£ã€ãŠã‚ˆã³Standardãƒ—ãƒ©ãƒ³UIã®ç£¨ãè¾¼ã¿ (å®Œäº†)
  - [x] `lib/instagram-client.ts` ã®å®Ÿè£…
  - [x] `api/instagram/post` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…
  - [x] UI å´ã¸ã®ã€ŒInstagram æŠ•ç¨¿ã€ãƒœã‚¿ãƒ³è¿½åŠ ã¨ãƒ—ãƒ©ãƒ³åˆ¶é™ã®æ§‹ç¯‰
  - [x] å®Ÿæ©ŸæŠ•ç¨¿ãƒ†ã‚¹ãƒˆã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°èª¿æ•´

- [x] **Phase 0: Safety & Inventory** `[x]`
  - [x] ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ (`src/lib/check-env.ts`)
  - [x] ãƒ‡ãƒ¼ã‚¿å°å¸³ (`Data_Inventory.md`)
- [x] **Phase 1: Auth Boundary** `[x]`
  - [x] `useAuth` ã®å³æ ¼åŒ–ã¨ `storeId` å–å¾—ã®å…±é€šåŒ–
  - [x] Server Side Auth Verification (`verifyIdToken`) ã®å®Ÿè£…
  - [x] `submit-reply` API ã®èªè¨¼ã‚’ Firebase Auth ã«å¤‰æ›´
- [x] **Phase 2: Data Unification (Firestore Migration)** `[x]`
  - [x] **Stats Design**: `tenants/{id}/stats` ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
  - [x] **Dashboard Updates**: `DashboardStats` ã‚’ç”¨ã„ãŸé›†è¨ˆè¡¨ç¤ºã¸ã®ç§»è¡Œ
  - [x] `src/app/dashboard/page.tsx` ã‚’ Firestore Admin SDK èª­ã¿å–ã‚Šã«å¤‰æ›´
- [x] **Phase 5: AI Cost Control & Governance** `[x]`
  - [x] **Cost Tracking**: `ai-quota.ts` ã‚’ã€Œå›æ•°ã€ã‹ã‚‰ã€Œäºˆç®—ï¼ˆå††ï¼‰ï¼‹å›æ•°ã€ã®äºŒé‡ç®¡ç†ã«ç§»è¡Œ
  - [x] **Safety Guard**: `ESTIMATED_COST_PER_TEXT_CALL_YEN` ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆç®—æ¸›ç®—ã®å®Ÿè£…
  - [x] **Isolation**: ç”»åƒç”Ÿæˆï¼ˆé«˜ã‚³ã‚¹ãƒˆï¼‰ã¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆï¼ˆä½ã‚³ã‚¹ãƒˆï¼‰ã®ã‚¯ã‚©ãƒ¼ã‚¿ç‰©ç†åˆ†é›¢
  - [x] **æ°¸ç¶šåŒ–**: `.cursorrules` & `AI_MODEL_STANDARDS.md` ã¸ã®æ©Ÿå¯†ãƒ«ãƒ¼ãƒ«è¿½è¨˜
- [x] **Phase 3: API Reliability** `[x]`
  - [x] **Idempotency**: `requests/{requestId}` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ `X-Request-ID` ã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯å®Ÿè£…
  - [x] **Transaction**: `submit-reply` APIã«ã€ŒStatsæ›´æ–° + å†ªç­‰æ€§ãƒã‚§ãƒƒã‚¯ã€ã‚’å®Œå…¨å®Ÿè£…
  - [x] **Validation**: è¿”ä¿¡æ–‡å­—æ•°åˆ¶é™(300æ–‡å­—)ã¨å…¥åŠ›å€¤æ¤œè¨¼ã®å¼·åŒ–
- [x] **Phase 4: Optimization & Cleanup** `[x]`
  - [x] **Build Fix**: `firebase-admin.ts` ã®ç’°å¢ƒå¤‰æ•°ãƒ‘ãƒ¼ã‚¹å …ç‰¢åŒ–ã¨ API ãƒ«ãƒ¼ãƒˆã®é™çš„ç”Ÿæˆã‚¨ãƒ©ãƒ¼è§£æ¶ˆ
  - [x] **Supabaseã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: Supabaseé–¢é€£ã‚³ãƒ¼ãƒ‰ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ç’°å¢ƒè¨­å®šã®å®Œå…¨å‰Šé™¤
  - [x] **è³‡ç”£åŒ–**: `10_é€²è¡Œä¸­ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ` & `20_é–‹ç™ºãƒã‚¦ãƒã‚¦` ã¸ã®æœ€æ–°ä»•æ§˜åŒæœŸ

- [x] **Phase 6: Pricing & Revenue Optimization** `[x]`
  - [x] **Pricing Update**: HPä½œæˆä»£è¡Œãƒ—ãƒ©ãƒ³ã‚’å«ã‚€4æ®µéšã®æ–™é‡‘ä½“ç³»ï¼ˆç¶­æŒç®¡ç†è²»è¾¼ã¿ï¼‰ã¸æ”¹å®š
  - [x] **UI Refactoring**: `src/app/plans/page.tsx` ã‚’æ–°æ–™é‡‘ä½“ç³»ã«åˆã‚ã›ã¦4ã‚«ãƒ©ãƒ æ§‹æˆã«åˆ·æ–°
  - [x] Light Plan & WEB Member Yearly Adjustment: ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ãƒ»WEBä¼šå“¡ã®å¹´æ‰•ã„ã‚’ã€Œ11ãƒ¶æœˆåˆ†ã€ã¸å€‹åˆ¥èª¿æ•´ã—å®Œå…¨åŒæœŸ
  - [x] **UI/UX Polished**: åˆ‡æ›¿ãƒœã‚¿ãƒ³ã®è¦–èªæ€§å‘ä¸Šï¼ˆç™½èƒŒæ™¯ï¼‹ã‚ªãƒ¬ãƒ³ã‚¸æ ï¼‰ã€ä¾¡æ ¼è¡¨è¨˜ã®æ­£ç¢ºåŒ–ã€ãƒ˜ãƒƒãƒ€ãƒ¼å‰Šé™¤
  - [x] **Specification Sync**: `PRICING_PLANS.md` ã®æ›´æ–°ã¨æˆ¦ç•¥ã®å®šç¾©
- [x] **Phase 7: UI/UX Fine-tuning & Polishing** `[x]`
  - [x] HPåˆ¶ä½œåˆæœŸè²»ç”¨ãƒãƒŠãƒ¼ã‚’ã‚ªãƒ¬ãƒ³ã‚¸ã«æˆ»ã—ã€SkyBlueãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
  - [x] **SaaSåˆ‡æ›¿ãƒãƒŠãƒ¼ï¼ˆé’ï¼‰**: HPåˆ¶ä½œãƒãƒŠãƒ¼ã¨åŒã˜ã‚µã‚¤ã‚ºã«çµ±ä¸€ãƒ»é…ç½®æœ€é©åŒ–
  - [x] **WEBå„ãƒ—ãƒ©ãƒ³ã®æ©Ÿèƒ½è©³ç´°åŒ–**: å…¨ã¦ã®HPåˆ¶ä½œãƒ—ãƒ©ãƒ³ã«å…·ä½“çš„æ©Ÿèƒ½ãƒªã‚¹ãƒˆã‚’è¿½åŠ 
  - [x] **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å®‰å®šåŒ–**: æ ã‚µã‚¤ã‚ºã®å›ºå®šã¨ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã®å¾®èª¿æ•´
  - [x] **æ–™é‡‘ãƒ—ãƒ©ãƒ³UIã®è¦–è¦šçš„å¼·èª¿**:
    - [x] æ©Ÿèƒ½ãƒªã‚¹ãƒˆï¼ˆã‚¢ã‚¤ã‚³ãƒ³ãƒ»ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã®ã‚µã‚¤ã‚ºã‚’25%æ‹¡å¤§
    - [x] ãƒ—ãƒ©ãƒ³ç¶™æ‰¿è¦‹å‡ºã—ï¼ˆXXX PLANã®å…¨æ©Ÿèƒ½ ï¼‹ï¼‰ã®ã‚µã‚¤ã‚ºã‚’15%æ‹¡å¤§
  - [x] **Single Source of Truth ç¢ºç«‹**:
    - [x] è²©å£²ãƒšãƒ¼ã‚¸ï¼ˆpage.tsxï¼‰ã‚’ã€Œæ­£ã€ã¨ã—ã¦ã€å…¨ä»•æ§˜æ›¸ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’åŒæœŸå®Œäº†

- [x] **Phase 8: Legal & Compliance** `[x]`
  - [x] **Legal Pages Implementation**: Terms of Service, Privacy Policy, SCTA notice.
  - [x] **Hardened Terms**: Added specific clauses for AI-generated responsibility and platform dependency disclaimers.
  - [x] **Universal Footer**: Created `Footer.tsx` and integrated it into `RootLayout` for sitewide legal compliance.
  - [x] **Doc Sync**: Updated `Dashboard.md` and Daily Reports.

- [x] **Phase 9: Dashboard Refresh & 2FA Implementation** `[x]`
  - [x] **UI Polishing**: Sidebar refresh with user account menu & clickable details.
  - [x] **Announcement System**: Integrated notification bell with popup announcements.
  - [x] **Account Management**: Created `/settings/account` page for profile & security management.
  - [x] **Two-Factor Authentication (2FA)**: Implemented TOTP & Email OTP setup and integrated into login flow.
  - [x] **Dark Mode Support**: Replaced hardcoded colors across all management screens (`/dashboard`, `/settings/*`) with theme-aware variables to ensure visibility and contrast.
  - [x] **Final Sync**: Updated all related documentation and task trackers.

- [x] **Phase 10: AI Quota Separation & Dashboard Logic Fix** `[x]`
  - [x] **Plan Mapping**: Normalized plan names (Standard/Pro) for accurate quota detection.
  - [x] **Quota Separation**: Physically separated "Text Generation" and "Image Generation" into two independent metrics.
  - [x] **Dashboard UI**: Expanded KPI grid to 5 columns with dedicated cards for text and image credits.
  - [x] **Optimistic UI**: Implemented immediate countdown for text usage upon successful reply.
  - [x] **Admin Fix**: Synced "Plan Mask" to Server Actions via cookies and corrected Standard quota (0 images).
- [x] **Phase 12: Gemini 3 Pro Strategy & Quota Expansion** `[x]`
  - [x] **Reasoning Validation**: Benchmark confirmed Gemini 3 Pro (LOW) superiority for review replies.
  - [x] **Model Strategy**: Defined 3 Pro LOW as primary, 3 Flash as secondary for all text features.
  - [x] **Quota Re-design**: Expanded text/image limits based on owner's cost ceiling (Standard: 500/50, Pro: 1000/200, Premium: 2000/450).
  - [x] **System Update**: Updated `lib/ai-quota.ts` constants and `PRICING_PLANS.md` specifications.
- [x] **Phase 17: HP Management Navigation** `[x]`
  - [x] ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¸ã®ã€ŒHPã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã€ãƒªãƒ³ã‚¯è¿½åŠ ã¨ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š
  - [x] `MaterialsPage` ã¸ã®å…±é€šã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé©ç”¨
- [x] **Phase 18: Plan Gating & Navigation Optimization** `[x]`
  - [x] `usePlanGuard` ãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£ï¼ˆåç§°ä¸€éƒ¨ä¸€è‡´ã§ã®åˆ¤å®šã¸ï¼‰
  - [x] ãƒ„ãƒ¼ãƒ«å˜ä½“ãƒ—ãƒ©ãƒ³ã¨WEBãƒ—ãƒ©ãƒ³ã®åˆ†é›¢ï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã®å‡ºã—åˆ†ã‘ï¼‰
- [x] **Troubleshooting**: ãƒ¡ãƒ¢ãƒªç•°å¸¸æ¶ˆè²»ãƒ—ãƒ­ã‚»ã‚¹ã®ç‰¹å®šã¨å¼·åˆ¶çµ‚äº† (æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒãƒ³ã‚°ã‚¢ãƒƒãƒ—è§£æ¶ˆ)
- [x] **Phase 20: Project Cleanup** `[x]`
  - [x] ä¸è¦ãªæ¤œè¨¼ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆscripts/ï¼‰13ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
  - [x] æ—§ç’°å¢ƒï¼ˆsupabase/ï¼‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å®Œå…¨å‰Šé™¤
  - [x] å‰Šé™¤ã«ä¼´ã†ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»å‹ä¸å‚™ã®è§£æ¶ˆã¨ãƒ“ãƒ«ãƒ‰æ­£å¸¸åŒ–
